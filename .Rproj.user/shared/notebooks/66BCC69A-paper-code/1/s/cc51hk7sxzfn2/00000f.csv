"0","set.seed(142)"
"0",""
"0","# Define recipe: centre and scale "
"0","foodcategory_recipe <- cleaned_data_reduced %>%"
"0","  dplyr::select(lsoa_code,dairy:`soft drinks`) %>%"
"0","  recipe(~ .) %>% "
"0","  step_center(all_numeric()) %>% "
"0","  step_scale(all_numeric()) %>%"
"0","  step_pca(all_numeric(), threshold = 0.80, id = ""pca"") %>%"
"0","  prep() "
"0",""
"0","# Calculate PCA loadings"
"0","loadings <- foodcategory_recipe %>%"
"0","  tidy(n = 3) %>%  # get tidy output for the first 3 principal components"
"0","  filter(component %in% c(""PC1"")) %>%  # filter for the first component"
"0","  mutate("
"0","    value = ifelse(component == ""PC1"", -value, value),"
"0","    # flip sign of PC1 loadings"
"0","    terms_ordered = fct_reorder(terms, abs(value)),"
"0","    pos = value < 0  # identify whether value is negative (for Figures 2-3)"
"0","  )"
"0",""
"0","# Percentage variance explained"
"0","variance_explained <- foodcategory_recipe %>% "
"0","  tidy(id = ""pca"", type = ""variance"") %>% "
"0","  dplyr::filter(terms == ""percent variance"")"
"0",""
"0","# Extract PC scores from foodcategory_recipe"
"0","PC_scores <- juice(foodcategory_recipe) %>% mutate(PC1=-PC1)"
